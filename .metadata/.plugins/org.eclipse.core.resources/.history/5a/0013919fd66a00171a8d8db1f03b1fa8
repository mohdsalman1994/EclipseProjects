package com.aceprogrammer.basics.CliniqueManagement;

import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.lang.reflect.Type;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.reflect.*;

public class CliniqueManager {
	
	FileReader patientFr;
	FileReader doctorFr;
	String appointmentFile = "src/resources/appointments.json";
	String patientsFile = "src/resources/patients.json";
	String doctorsFile = "src/resources/doctors.json";
	List<Patient> patientList;
	List<Doctor> doctorList;
	Map<Integer, Map<Doctor, List<Patient>>> appointmentDetails;

	public CliniqueManager() throws IOException
	{
		try(FileReader patientFr = new FileReader(patientsFile);
		FileReader doctorFr = new FileReader(doctorsFile);)
		
		{
		Gson gson = new Gson();
		
		// read patient data from JSON file
		Type patientType = new TypeToken<List<Patient>>(){}.getType();			
		patientList = gson.fromJson(patientFr, patientType);
		
		// read doctor data from JSON file
		Type doctorType = new TypeToken<List<Doctor>>(){}.getType();			
		doctorList = gson.fromJson(doctorFr, doctorType);
		}
	}
	
	// display the list of patients
	public void displayPatients()
	{
		patientList.forEach(System.out::println);
						
	}
	
	// display list of doctors
	public void displayDoctors()
	{
		doctorList.forEach(System.out::println);
						
	}
	
    public void writeAppointments() throws IOException
    {
    	appointmentDetails = new TreeMap<Integer, Map<Doctor,List<Patient>>>();
    	Map<Doctor, List<Patient>> docPatient = new HashMap<>();
    	Doctor doc = doctorList.get(0);
    	docPatient.put(doc, patientList);
    	appointmentDetails.put(1, docPatient);
    	Gson gson = new GsonBuilder().disableHtmlEscaping().create();
    	
    	try (FileWriter appointmentWriter = new FileWriter(appointmentFile)) {

            gson.toJson(appointmentDetails, appointmentWriter);

        }
    }
	
	// display doctor-patient report
	
	// make appointments
	
	public static void main(String[] args) throws IOException {
		CliniqueManager cMan = new CliniqueManager();
		cMan.displayPatients();
		cMan.displayDoctors();
		cMan.writeAppointments();
	}
	
}
